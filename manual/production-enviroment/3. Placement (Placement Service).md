# Run on Controller
## Prerequisites
---
### Prepare SQL Databases
```shell
mysql
```
```shell
CREATE DATABASE placement;
GRANT ALL PRIVILEGES ON placement.* TO 'placement'@'localhost' IDENTIFIED BY 'OpenStack';
GRANT ALL PRIVILEGES ON placement.* TO 'placement'@'%' IDENTIFIED BY 'OpenStack';
EXIT;
```
### Prepare Keystone
```shell
. admin-openrc
```
```shell
openstack user create --domain default --password 'OpenStack' placement
openstack role add --project service --user placement admin
openstack service create --name placement --description "Placement API" placement
openstack endpoint create --region RegionOne placement public https://placement.kbuor.io.vn:8778
openstack endpoint create --region RegionOne placement internal https://placement.kbuor.io.vn:8778
openstack endpoint create --region RegionOne placement admin https://placement.kbuor.io.vn:8778
```
## Install and configure components
---
```shell
apt install placement-api -y
```
```shell
cat <<'EOF' > /etc/placement/placement.conf
[DEFAULT]
[api]
auth_strategy = keystone
[cors]
[keystone_authtoken]
auth_url = https://placement.kbuor.io.vn:5000/v3
memcached_servers = placement.kbuor.io.vn:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = placement
password = OpenStack
[oslo_middleware]
[oslo_policy]
[placement]
[placement_database]
connection = mysql+pymysql://placement:OpenStack@controller01.openstack.local/placement
[profiler]
EOF
```
```shell
su -s /bin/sh -c "placement-manage db sync" placement
```
## Configure the Apache HTTP server
---
```shell
cat <<'EOF' > /etc/apache2/sites-available/placement-https.conf
Listen 8778
<VirtualHost *:8778>
    WSGIScriptAlias / /usr/bin/placement-api
    WSGIDaemonProcess placement-api processes=5 threads=1 user=placement group=placement display-name=%{GROUP}
    WSGIProcessGroup placement-api
    WSGIApplicationGroup %{GLOBAL}
    WSGIPassAuthorization On
    LimitRequestBody 114688

    <IfVersion >= 2.4>
      ErrorLogFormat "%{cu}t %M"
    </IfVersion>

    ErrorLog /var/log/apache2/placement_api_error.log
    CustomLog /var/log/apache2/placement_api_access.log combined

    <Directory /usr/bin>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
        <IfVersion < 2.4>
            Order allow,deny
            Allow from all
        </IfVersion>
    </Directory>
</VirtualHost>

Alias /placement /usr/bin/placement-api
<Location /placement>
  SetHandler wsgi-script
  Options +ExecCGI

  WSGIProcessGroup placement-api
  WSGIApplicationGroup %{GLOBAL}
  WSGIPassAuthorization On
</Location>
EOF
echo "Listen 8778" >> /etc/apache2/ports.conf
```
```shell
a2ensite placement-https
systemctl restart apache2
systemctl reload apache2
```
