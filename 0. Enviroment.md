# Network Time Protocol (NTP)
## Controller Node
1. Install the packages:
```shell
apt install chrony -y
```
```shell
root@controller:~# apt install -y chrony
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  systemd-timesyncd
The following NEW packages will be installed:
  chrony
0 upgraded, 1 newly installed, 1 to remove and 0 not upgraded.
Need to get 290 kB of archives.
After this operation, 360 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 chrony amd64 4.2-2ubuntu2 [290 kB]
Fetched 290 kB in 2s (144 kB/s)                     
(Reading database ... 94061 files and directories currently installed.)
Removing systemd-timesyncd (249.11-0ubuntu3.12) ...
Selecting previously unselected package chrony.
(Reading database ... 94047 files and directories currently installed.)
Preparing to unpack .../chrony_4.2-2ubuntu2_amd64.deb ...
Unpacking chrony (4.2-2ubuntu2) ...
Setting up chrony (4.2-2ubuntu2) ...

Creating config file /etc/chrony/chrony.conf with new version

Creating config file /etc/chrony/chrony.keys with new version
dpkg-statoverride: warning: --update given but /var/log/chrony does not exist
Created symlink /etc/systemd/system/chronyd.service → /lib/systemd/system/chrony.service.
Created symlink /etc/systemd/system/multi-user.target.wants/chrony.service → /lib/systemd/system/chrony.service.
Processing triggers for dbus (1.12.20-2ubuntu4.1) ...
Processing triggers for man-db (2.10.2-1) ...
Scanning processes...                                                                                                                                         
Scanning linux images...                                                                                                                                      

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
```

2. Edit the **chrony.conf** file and add, change, or remove the following keys as necessary for your environment.
```shell
vi /etc/chrony/chrony.conf
```
```shell
confdir /etc/chrony/conf.d
sourcedir /run/chrony-dhcp
sourcedir /etc/chrony/sources.d
keyfile /etc/chrony/chrony.keys
driftfile /var/lib/chrony/chrony.drift
ntsdumpdir /var/lib/chrony
logdir /var/log/chrony
maxupdateskew 100.0
rtcsync
makestep 1 3
leapsectz right/UTC
server 0.vn.pool.ntp.org iburst
allow 10.0.0.0/24
```

3. Restart the NTP service:
```shell
systemctl enable chrony
systemctl start chrony
```
```shell
root@controller:~# systemctl start chrony
root@controller:~# systemctl enable chrony
Synchronizing state of chrony.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable chrony
```

4. Verify NTP service:
```shell
chronyc sources
```
```shell
root@controller:~# chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^- prod-ntp-3.ntp4.ps5.cano>     2   6   377    63  +4561us[+4551us] +/-  102ms
^- prod-ntp-5.ntp1.ps5.cano>     2   6   377    62  +5390us[+5390us] +/-  102ms
^- prod-ntp-4.ntp4.ps5.cano>     2   6   377    64  +4624us[+4615us] +/-  103ms
^- alphyn.canonical.com          2   6   377    62  -4165us[-4165us] +/-  156ms
^+ 103.70.115.65                 3   6   377     2   +230us[ +230us] +/-   38ms
^- 115.165.161.155               2   6   377    64   +456us[ +446us] +/-   19ms
^+ play.xtdv.gr                  2   6   377    57    +28ms[  +28ms] +/-   45ms
^* 27.71.27.209                  2   6   375    63   -246us[ -256us] +/-   18ms
```
